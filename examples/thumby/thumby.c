// TODO
// Fix this issue with division: i'm running into the same issue when i replace y = 2 + (counter / 16); with y = 2 + (counter >> 4); o_o

#include <stdio.h>
#include <string.h>
#include <gb/gb.h>

#define MIN(a,b) (((a)<(b))?(a):(b))
#define MAX(a,b) (((a)>(b))?(a):(b))

void set_text_map(char *text, UBYTE len);
void clear_window();
void sleep(UBYTE cycles);
void scroll_text(UBYTE len);
void process_button_press(UBYTE *x, UBYTE *y);
void update_girl_sprite(UBYTE x, UBYTE y);
void check_level_one();
void set_girl_sprite();
UBYTE divide_ubyte(UBYTE a, UBYTE b);
void pass_level_one();
void show_text(char *text);


#define grass_tiles_len 5
unsigned char grass_tiles[] =
{
  0x00,0x00,0x00,0x00,0x10,0x00,0x54,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x20,0x00,0xA4,0x00,0x00,0x00,

  0x00,0x00,0x04,0x00,0x08,0x02,0x01,0x2E,
  0x00,0x00,0x00,0x00,0x40,0x00,0x40,0x20,

  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x10,0x00,0x20,0x08,0x04,0x38,0x00,0x00,

  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define grass_field_width 32
#define grass_field_height 32
#define grass_fieldBank 0

unsigned char grass_field[] =
{
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x03,0x02,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x03,0x02,0x03,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x02,0x03,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x03,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x02,0x01,0x02,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x03,0x02,0x00,0x02,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x02,0x03,0x02,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x03,0x02,
  0x03,0x02,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x03,0x02,0x03,0x02,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x02,0x03,0x02,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x03,0x02,0x01,0x02,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x02,0x03,0x02,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x02,0x01,
  0x02,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x02,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x02,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x02,0x03,0x02,0x03,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x03,0x02,0x03,0x02,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x02,0x03,0x02,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x03,0x02,
  0x03,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x02,0x03,0x02,0x03,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x02,0x03,0x02,0x03,0x02,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x02,0x01,0x02,0x03,0x02,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
  0x00,0x01,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x03,
  0x00,0x01,0x00,0x01
};

#define girl_tiles_len 16
// unsigned char girl_tiles[] =
// {
//   0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,
//   0x03,0x03,0x02,0x03,0x02,0x03,0x02,0x03,
//   0x02,0x03,0x03,0x02,0x02,0x03,0x01,0x01,
//   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

//   0x1F,0x1F,0x70,0x7F,0xC0,0xFF,0x80,0xFF,
//   0x40,0xBF,0xD0,0x3F,0x89,0x7F,0x34,0xEF,
//   0x7B,0xD6,0x5F,0xCF,0x47,0xC0,0x40,0xC0,
//   0xD8,0xD8,0x64,0x64,0x38,0x20,0x70,0x71,

//   0x00,0x00,0x01,0x01,0x02,0x02,0x05,0x04,
//   0x02,0x02,0x01,0x01,0x03,0x02,0x02,0x02,
//   0x04,0x04,0x04,0x04,0x07,0x04,0x03,0x03,
//   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

//   0x8F,0x8F,0x00,0x03,0x80,0x05,0x40,0x06,
//   0xA0,0x02,0x50,0x02,0xF8,0xF8,0xFF,0x47,
//   0x7F,0x42,0x7F,0x7F,0xAA,0xB7,0xAA,0xB5,
//   0x3F,0x3F,0x12,0x12,0x12,0x12,0x3E,0x3E,

//   0xF0,0xF0,0x1C,0xFC,0x26,0xDE,0x1B,0xE7,
//   0x09,0xF7,0x05,0xFB,0x00,0xFF,0x80,0xFF,
//   0x49,0xFE,0xB5,0x6E,0xFD,0xFF,0x7F,0x07,
//   0x36,0x36,0x4C,0x4C,0x38,0x08,0x1C,0x1C,

//   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//   0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,
//   0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,
//   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

//   0xE2,0xE2,0x01,0x81,0x02,0x40,0x05,0xC0,
//   0x0A,0x80,0x15,0x81,0x3F,0x3E,0xFE,0xC4,
//   0xFC,0x84,0xFC,0xFC,0xAB,0xDA,0xAB,0x5B,
//   0xF8,0xF8,0x90,0x90,0x90,0x90,0xF8,0xF8,

//   0x00,0x00,0x00,0x00,0x80,0x80,0x40,0x40,
//   0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,
//   0x40,0x40,0x40,0x40,0xC0,0x40,0x80,0x80,
//   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
// };
unsigned char girl_tiles[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,
  0x03,0x03,0x02,0x03,0x02,0x03,0x02,0x03,
  0x02,0x03,0x03,0x02,0x02,0x03,0x01,0x01,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

  0x1F,0x1F,0x70,0x7F,0xC0,0xFF,0x80,0xFF,
  0x40,0xBF,0xD0,0x3F,0x89,0x7F,0x34,0xEF,
  0x7B,0xD6,0x5F,0xCF,0x47,0xC0,0x40,0xC0,
  0xD8,0xD8,0x64,0x64,0x38,0x20,0x70,0x71,

  0x00,0x00,0x01,0x01,0x02,0x02,0x05,0x04,
  0x02,0x02,0x01,0x01,0x03,0x02,0x02,0x02,
  0x04,0x04,0x04,0x04,0x07,0x04,0x03,0x03,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

  0x8F,0x8F,0x00,0x05,0x80,0x07,0x40,0x05, // This is the one I want to check
  0xA0,0x00,0x50,0x00,0xF8,0xF8,0xFF,0x47,
  0x7F,0x42,0x7F,0x7F,0xAA,0xB7,0xAA,0xB5,
  0x3F,0x3F,0x12,0x12,0x12,0x12,0x3E,0x3E,

  0xF0,0xF0,0x1C,0xFC,0x26,0xDE,0x1B,0xE7,
  0x09,0xF7,0x05,0xFB,0x00,0xFF,0x80,0xFF,
  0x49,0xFE,0xB5,0x6E,0xFD,0xFF,0x7F,0x07,
  0x36,0x36,0x4C,0x4C,0x38,0x08,0x1C,0x1C,

  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,
  0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

  0xE2,0xE2,0x01,0x41,0x02,0x40,0x05,0x40,
  0x0A,0x00,0x15,0x01,0x3F,0x3E,0xFE,0xC4,
  0xFC,0x84,0xFC,0xFC,0xAB,0xDA,0xAB,0x5B,
  0xF8,0xF8,0x90,0x90,0x90,0x90,0xF8,0xF8,

  0x00,0x00,0x00,0x00,0x80,0x80,0x40,0x40,
  0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,
  0x40,0x40,0x40,0x40,0xC0,0x40,0x80,0x80,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define girl_pj_tiles_len 16
unsigned char girl_pj_tiles[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,
  0x03,0x03,0x02,0x03,0x02,0x03,0x02,0x03,
  0x02,0x03,0x03,0x02,0x02,0x03,0x01,0x01,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x1F,0x1F,0x70,0x7F,0xC0,0xFF,0x80,0xFF,
  0x40,0xBF,0xD0,0x3F,0x89,0x7F,0x34,0xEF,
  0x7B,0xD6,0x5F,0xCF,0x47,0xC0,0x40,0xC0,
  0xC0,0xC0,0x6C,0x6C,0x38,0x20,0x10,0x10,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x01,0x01,0x01,0x01,0x02,0x02,0x02,0x02,
  0x04,0x04,0x04,0x04,0x07,0x04,0x03,0x03,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x3F,0x3F,0x7C,0x54,0x7F,0x53,0x9F,0x90,
  0x3D,0x20,0x3C,0x20,0x7E,0x60,0x7F,0x60,
  0x7F,0x7F,0xB2,0xAD,0xA9,0xB6,0xA7,0xBB,
  0x3E,0x3E,0x12,0x12,0x12,0x12,0x3E,0x3E,
  0xF0,0xF0,0x1C,0xFC,0x26,0xDE,0x1B,0xE7,
  0x09,0xF7,0x05,0xFB,0x00,0xFF,0x80,0xFF,
  0x49,0xFE,0xB5,0x6E,0xFD,0xFF,0x7F,0x07,
  0x06,0x06,0x6C,0x6C,0x38,0x08,0x10,0x10,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,
  0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xF8,0xF8,0x7C,0x54,0xFC,0x94,0xF2,0x12,
  0x79,0x09,0x79,0x09,0xFC,0x0C,0xFC,0x0C,
  0xFC,0xFC,0x4A,0xBA,0x2B,0xDA,0x9B,0xEB,
  0xF8,0xF8,0x90,0x90,0x90,0x90,0xF8,0xF8,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,
  0x40,0x40,0x40,0x40,0xC0,0x40,0x80,0x80,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};


// 8 tiles + 1 blank tile
#define window_border_len 9
unsigned char window_border[] =
{
  0x1F,0x1F,0x20,0x3F,0x40,0x70,0x87,0xE0,
  0x8F,0xC3,0x9C,0xC4,0x98,0xC8,0x98,0xC8,
  0x98,0xC8,0x98,0xC8,0x98,0xC8,0x98,0xC8,
  0x98,0xC8,0x98,0xC8,0x98,0xC8,0x98,0xC8,
  0xFF,0xFF,0x00,0xFF,0x00,0x00,0xFF,0x00,
  0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
  0x98,0xC8,0x98,0xC8,0x94,0xC8,0x83,0xCC,
  0x80,0xE7,0x40,0x70,0x2F,0x30,0x1F,0x1F,
  0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,
  0x00,0xFF,0x00,0x00,0xFF,0x00,0xFF,0xFF,
  0x13,0x09,0x13,0x09,0x23,0x19,0xC3,0x31,
  0x07,0xE1,0x0E,0x02,0xFC,0x04,0xF8,0xF8,
  0x13,0x09,0x13,0x09,0x13,0x09,0x13,0x09,
  0x13,0x09,0x13,0x09,0x13,0x09,0x13,0x09,
  0xF8,0xF8,0x04,0xFC,0x02,0x0E,0xE1,0x07,
  0xF1,0xC3,0x23,0x39,0x13,0x09,0x13,0x09,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#define text_box_width 20
#define text_box_height 6
#define text_boxBank 0

unsigned char text_box[] =
{
  0x80,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,
  0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0x87,
  0x81,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,
  0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x86,
  0x81,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,
  0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x86,
  0x81,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,
  0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x86,
  0x81,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,
  0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x86,
  0x83,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,
  0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x85
};

//ALPHABET CHARACTERS
#define alphabet_len 47 // Number of tiles
unsigned char alphabet[] =
{
    // Numbers
    0x38,0x38,0x4C,0x4C,0xC6,0xC6,0xC6,0xC6,
    0xC6,0xC6,0x64,0x64,0x38,0x38,0x00,0x00,
    0x18,0x18,0x38,0x38,0x18,0x18,0x18,0x18,
    0x18,0x18,0x18,0x18,0x7E,0x7E,0x00,0x00,
    0x7C,0x7C,0xC6,0xC6,0x0E,0x0E,0x3C,0x3C,
    0x78,0x78,0xE0,0xE0,0xFE,0xFE,0x00,0x00,
    0x7E,0x7E,0x0C,0x0C,0x18,0x18,0x3C,0x3C,
    0x06,0x06,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0x1C,0x1C,0x3C,0x3C,0x6C,0x6C,0xCC,0xCC,
    0xFE,0xFE,0x0C,0x0C,0x0C,0x0C,0x00,0x00,
    0xFC,0xFC,0xC0,0xC0,0xFC,0xFC,0x06,0x06,
    0x06,0x06,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0x3C,0x3C,0x60,0x60,0xC0,0xC0,0xFC,0xFC,
    0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0xFE,0xFE,0xC6,0xC6,0x0C,0x0C,0x18,0x18,
    0x30,0x30,0x30,0x30,0x30,0x30,0x00,0x00,
    0x78,0x78,0x84,0x84,0xC4,0xC4,0x78,0x78,
    0x9E,0x9E,0x86,0x86,0x7C,0x7C,0x00,0x00,
    0x7C,0x7C,0xC6,0xC6,0xC6,0xC6,0x7E,0x7E,
    0x06,0x06,0x0C,0x0C,0x78,0x78,0x00,0x00,

    // Letters and symbols
    0x38,0x38,0x6C,0x6C,0xC6,0xC6,0xC6,0xC6,
    0xFE,0xFE,0xC6,0xC6,0xC6,0xC6,0x00,0x00,
    0xFC,0xFC,0xC6,0xC6,0xC6,0xC6,0xFC,0xFC,
    0xC6,0xC6,0xC6,0xC6,0xFC,0xFC,0x00,0x00,
    0x3C,0x3C,0x66,0x66,0xC0,0xC0,0xC0,0xC0,
    0xC0,0xC0,0x66,0x66,0x3C,0x3C,0x00,0x00,
    0xF8,0xF8,0xCC,0xCC,0xC6,0xC6,0xC6,0xC6,
    0xC6,0xC6,0xCC,0xCC,0xF8,0xF8,0x00,0x00,
    0xFE,0xFE,0xC0,0xC0,0xC0,0xC0,0xFC,0xFC,
    0xC0,0xC0,0xC0,0xC0,0xFE,0xFE,0x00,0x00,
    0xFE,0xFE,0xC0,0xC0,0xC0,0xC0,0xFC,0xFC,
    0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,
    0x3E,0x3E,0x60,0x60,0xC0,0xC0,0xCE,0xCE,
    0xC6,0xC6,0x66,0x66,0x3E,0x3E,0x00,0x00,
    0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xFE,0xFE,
    0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x00,0x00,
    0x7E,0x7E,0x18,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0x18,0x18,0x7E,0x7E,0x00,0x00,
    0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x06,
    0x06,0x06,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0xC6,0xC6,0xCC,0xCC,0xD8,0xD8,0xF0,0xF0,
    0xF8,0xF8,0xDC,0xDC,0xCE,0xCE,0x00,0x00,
    0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
    0xC0,0xC0,0xC0,0xC0,0xFE,0xFE,0x00,0x00,
    0xC6,0xC6,0xEE,0xEE,0xFE,0xFE,0xFE,0xFE,
    0xD6,0xD6,0xC6,0xC6,0xC6,0xC6,0x00,0x00,
    0xC6,0xC6,0xE6,0xE6,0xF6,0xF6,0xFE,0xFE,
    0xDE,0xDE,0xCE,0xCE,0xC6,0xC6,0x00,0x00,
    0x7C,0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,
    0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0xFC,0xFC,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,
    0xFC,0xFC,0xC0,0xC0,0xC0,0xC0,0x00,0x00,
    0x7C,0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,
    0xDE,0xDE,0xCC,0xCC,0x7A,0x7A,0x00,0x00,
    0xFC,0xFC,0xC6,0xC6,0xC6,0xC6,0xCE,0xCE,
    0xF8,0xF8,0xDC,0xDC,0xCE,0xCE,0x00,0x00,
    0x78,0x78,0xCC,0xCC,0xC0,0xC0,0x7C,0x7C,
    0x06,0x06,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0x7E,0x7E,0x18,0x18,0x18,0x18,0x18,0x18,
    0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,
    0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,
    0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
    0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,
    0x6C,0x6C,0x38,0x38,0x10,0x10,0x00,0x00,
    0xC6,0xC6,0xC6,0xC6,0xD6,0xD6,0xFE,0xFE,
    0xFE,0xFE,0x6C,0x6C,0x44,0x44,0x00,0x00,
    0xC6,0xC6,0xEE,0xEE,0x7C,0x7C,0x38,0x38,
    0x7C,0x7C,0xEE,0xEE,0xC6,0xC6,0x00,0x00,
    0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x3C,
    0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,
    0xFE,0xFE,0x0E,0x0E,0x1C,0x1C,0x38,0x38,
    0x70,0x70,0xE0,0xE0,0xFE,0xFE,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x18,0x18,0x18,0x18,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x18,0x18,0x18,0x18,0x30,0x30,
    0x18,0x18,0x3C,0x3C,0x3C,0x3C,0x3C,0x3C,
    0x18,0x18,0x00,0x00,0x18,0x18,0x00,0x00,
    0x7C,0x7C,0xC6,0xC6,0x06,0x06,0x1C,0x1C,
    0x38,0x38,0x00,0x00,0x38,0x38,0x00,0x00,
    0x00,0x00,0x00,0x00,0x60,0x60,0xF2,0xF2,
    0x9E,0x9E,0x0C,0x0C,0x00,0x00,0x00,0x00,
    0xCC,0xCC,0xAA,0xAA,0xAA,0xAA,0xCC,0xCC,
    0xAA,0xAA,0xAA,0xAA,0xAC,0xAC,0x00,0x00,
    0xEC,0xEC,0x8A,0x8A,0x8A,0x8A,0xCA,0xCA,
    0x8A,0x8A,0x8A,0x8A,0xEC,0xEC,0x00,0x00,
    0x18,0x18,0x66,0x66,0x81,0x81,0xE7,0xE7,
    0x99,0x99,0x99,0x99,0x7E,0x7E,0x18,0x18,
    0x00,0x00,0x24,0x24,0x24,0x24,0x00,0x00,
    0x24,0x24,0x3C,0x3C,0x00,0x00,0x00,0x00,
    0x00,0x00,0x24,0x24,0x24,0x24,0x00,0x00,
    0x3C,0x3C,0x24,0x24,0x00,0x00,0x00,0x00,
    0x00,0x00,0x24,0x24,0x24,0x24,0x00,0x00,
    0x3C,0x3C,0x24,0x24,0x18,0x18,0x00,0x00
  };

#define arrow_address_1 0x34U
#define arrow_address_2 0x35U
#define arrow_tile_len 2U // number of 8*8 tiles
unsigned char arrow_tile[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7E,
  0x7E,0x7E,0x7E,0x7E,0x3C,0x3C,0x18,0x18,
  0x00,0x00,0x00,0x00,0x00,0x7E,0x7E,0x7E,
  0x7E,0x7E,0x3C,0x3C,0x18,0x18,0x00,0x00
};

#define text_map_width 16
#define text_map_height 2
unsigned char text_map[] =
{
    22,23,41,04,04,04,04,04,04,04,04,04,04,04,04,04,
    04,04,04,04,04,04,04,04,04,04,04,04,04,04,04,04
};

// FIXME remove this lol
unsigned char python_puzzle[] =
"import sys;k=int(sys.argv[1]);print(\"\".join(chr(ord(c)^k) for c in \"YOIXO^\nIENO\"));";


// Edits the text map
// Must call update separately for the text to appear in the window
// Only supports _uppercase_ characters, numbers and .,?!~
// Does not check for validity of input characters.
// You must also handle new lines yourself.
// You can write up to 31 characters.
// The last character is the arrow prompt.
// Please use with caution
void set_text_map(char *text, UBYTE len)
{
    UBYTE i;
    // Letters start at tile 16
    // Numbers start at tile 5

    // Reset text map to all blank spaces
    // Space is tile 4
    // FIXME the space tile number shouldn't be hard coded
    memset(text_map, 4, text_map_width*text_map_height);

    // Don't try to set the text if there is nothing to write
    if (!text || len > 32 || len <= 0) {
        return;
    }


    // FIXME THIS SHOULDN"T BE HARDCODED TILE INDECIES

    for (i = 0; i < len; ++i) {
        // Upper case characters
        if (text[i] >= 'A' && text[i] <= 'Z') {
            text_map[i] = text[i] - 'A' + 0xF; // eg. character A - ascii value of A + index of A in VRAM
        }

        // Numbers
        if (text[i] >= '0' && text[i] <= '9') {
            text_map[i] = text[i] - '0' + 0x5;
        }

        // Symbols (,.?!~)
        if (text[i] == '.') {
            text_map[i] = 0x29;
        } else if (text[i] == ',') {
            text_map[i] = 0x2A;
        } else if (text[i] == '!') {
            text_map[i] = 0x2B;
        } else if (text[i] == '?') {
            text_map[i] = 0x2C;
        } else if (text[i] == '~') {
            text_map[i] = 0x2D;
        }
    }

    // Write the arrow as the last character.
    text_map[len] = arrow_address_1;
}

// CAREFUL
// This function will edit the text map
void clear_window()
{
    // FIXME more hard coded tile indices
    memset(text_map, 4, text_map_width*text_map_height);
    set_win_tiles(2, 2, text_map_width, text_map_height, text_map);
}

UBYTE divide_ubyte(UBYTE a, UBYTE b)
{
    // Return a / b
    UBYTE result = 0;
    while (a >= b) {
        a -= b;
        result++;
    }
    return result;
}

// Scroll text
// Display the new text character by character
// Assumes that the text_map has already been set
// Assumes that we are writing to a blank window.
// Must have called clear window before calling this.
void scroll_text(UBYTE len)
{
    UBYTE counter, x, y;
    for (counter = 0; counter < len; ++counter) {
        x = 2 + (counter % 16);
        y = 2 + divide_ubyte(counter, 16);
        // FIXME why wouldn't division work?
        // y = 2 + (counter / 16);
        // printf("%d\n", (unsigned int)y);
        set_win_tiles(x, y, 1, 1, &text_map[counter]);
        sleep(4);
    }
}

void sleep(UBYTE cycles)
{
    UBYTE counter;
    for(counter = 0; counter < cycles; counter++){
        wait_vbl_done();
    }
}

void process_button_press(UBYTE *x, UBYTE *y)
{
    UBYTE input = joypad();
    UBYTE move = 1;

    // Hold A to dash
    if(input & J_A)
        move += 2;

    // Movement
    if(input & J_UP)
        *y -= move;
    if(input & J_DOWN)
        *y += move;
    if(input & J_LEFT)
        *x -= move;
    if(input & J_RIGHT)
        *x += move;

    // Basic collision detection
    // Prevent the girl from walking off screen
    // FIXME MAKE THESE NOT HARDCODED
    // FIXME this collision doesn't really work lol... looks buggy
    *x = MAX(7, *x);
    *x = MIN(160, *x);
    *y = MAX(7, *y);
    *y = MIN(144, *y);
}

void set_girl_sprite()
{
    UBYTE counter;
    for (counter = 0; counter < 8; ++counter) {
        // FIXME also try inlining 2 byte nop
        // c6 10 <- add 10 to register `a`
        counter++;
        counter--;
        set_sprite_tile(counter, counter*2);
    }
}

// x and y are the index of tile 0
void update_girl_sprite(UBYTE x, UBYTE y)
{
    // LOL FIXME
    move_sprite(0,x+(0%4)*8,y+(0/4)*16);
    move_sprite(1,x+(1%4)*8,y+0*16);
    move_sprite(2,x+(0%4)*8,y+(1)*16);
    move_sprite(3,x+(1%4)*8,y+(1)*16);

    move_sprite(4,x+(2%4)*8,y+(0/4)*16);
    move_sprite(5,x+(3%4)*8,y+0*16);
    move_sprite(6,x+(2%4)*8,y+(1)*16);
    move_sprite(7,x+(3%4)*8,y+(1)*16);
}

// Checks that the girl is dressed or check that we skipped the check
void check_level_one()
{
    UBYTE counter, result = 1;
    UBYTE tile_data[24] = {0};

    // Solution 1: Set sprite tiles to girl_tiles
    for (counter = 0; counter < 8; ++counter) {
        result &= (get_sprite_tile(counter) == (0x10U + counter));
    }

    // Solution 3: Jump over the check sprite condition, but you won't see the flag OTL....
    if (result == 1) {
        pass_level_one();
    }

    // Solution 2: Overwrite girl_pj_tiles with girl_tiles (eg modify 21 10 10 -> 21 00 10)
    get_sprite_data(6, 2, tile_data);
    // 16 is the size in bytes of a 8*16 tile.
    result = (memcmp(tile_data, &(girl_tiles[16*3]), 16) == 0);

    // Can I check ROM directly? to see if the bytes were edited? That seems too specific...

    // Solution 3: Jump over the check sprite condition, but you won't see the flag OTL....
    if (result == 1) {
        pass_level_one();
    }

    // Solution 4: Reverse the sprite art directly lol.
}

void pass_level_one()
{
    SHOW_WIN;

    show_text("DO YOU SEE MY   NEW OUTFIT?");
    waitpad(J_A);

    show_text("IS IT NOT CUTE?");
    waitpad(J_A);

    // FIXME make the most obvious hint not plain english
    show_text("I WONDER IF IT  ENCODES...");
    waitpad(J_A);
    show_text("A SECRET FLAG!");
    waitpad(J_A);
    HIDE_WIN;

    while(1) {}
    // FIXME Should start level 2 here
}

void show_text(char *text)
{
    UBYTE x, y;
    UBYTE cursor_state = 0;
    UBYTE text_len = strlen(text);

    clear_window();
    set_text_map(text, text_len);

    // Plus one to account for the extra arrow character.
    text_len++;
    scroll_text(text_len);

    // Animate the cursor while waiting for text to advance
    // from button input.
    x = 2 + (text_len % 16);
    y = 2 + divide_ubyte(text_len, 16);
    // FIXME why wouldn't division work? same issue as above...
    while (~(joypad() & J_A)) {
        if (cursor_state == 0) {
            text_map[text_len] = arrow_address_2;
        } else {
            text_map[text_len] = arrow_address_1;
        }

        set_win_tiles(x, y, 1, 1, &text_map[text_len]);
        cursor_state = !cursor_state;
        delay(8);
    }
}

void main()
{
    UBYTE counter,x,y;
    x=40;
    y=40;

    disable_interrupts();
    DISPLAY_OFF;

    // load background
    set_bkg_data(0, grass_tiles_len, grass_tiles);
    set_bkg_tiles(0, 0, grass_field_width, grass_field_height, grass_field);

    // load sprite
    SPRITES_8x16;
    set_sprite_data(0, girl_pj_tiles_len, girl_pj_tiles);
    set_sprite_data(16, girl_tiles_len, girl_tiles);
    set_girl_sprite();
    update_girl_sprite(x, y);

    // Initialize the window
    set_win_data(0x80, window_border_len, window_border);
    set_win_tiles(0, 0, text_box_width, text_box_height, text_box);
    move_win(7,96);

    // Write text to the window
    set_win_data(5U, alphabet_len, alphabet);
    set_win_tiles(2U, 2U, text_map_width, text_map_height, text_map);

    // Set the arrow in memory
    set_win_data(arrow_address_1, arrow_tile_len, arrow_tile);

    // FIXME delete this
    // Set some python as sprite data??
    set_sprite_data(32, 10, python_puzzle); // starting at tile 32 for 10 tiles

    SHOW_BKG;
    SHOW_SPRITES;
    DISPLAY_ON;
    enable_interrupts();

    // Check if this game has been solved.
    // check_level_one();

    SHOW_WIN;
    show_text("MORNING...");
    show_text("HELP ME GET DRESSED.");
    show_text("MY CLOTHES ARE  IN VRAM.");
    HIDE_WIN;

    while(1) {
        /* Skip four VBLs (slow down animation) */
        for(counter = 0; counter < 4; counter++){
            wait_vbl_done();
        }
        process_button_press(&x, &y);
        update_girl_sprite(x, y);
    }
}

// 20 tiles across, 18 down <- main screen size